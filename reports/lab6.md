# Lab 6

文件系统本身的实现挺简单的，不过这里用Rust实现的话就涉及到很多技巧了，其中的闭包实现可以很灵活地进行相关处理。

做硬链接的话可以在目录项里指向同一个`DiskInode`，然后`DiskInode`中加一项记录目前的硬链接的个数。注意`INODE_DIRECT_COUNT`要相应进行减少，这点在实验指导书中已经提到了。

在实现的时候有考虑添加硬链接这个事应该放在`Inode`里面还是`EasyFileSystem`里面，感觉放到后者更合理些？不过为了实现方便还是选择了前者。
实现上核心代码就借用`create`里面的就好了，只不过不用`alloc_inode`新分配而是使用已有的inode号加到目录项里。

在实现`unlink`的时候我按照`rCore-Tutorial-Book`的要求把`nlink`为0的时候删除文件也实现了。这里是用了`clear`函数的功能的，不过因为`clear`里面也会对`fs`获取`lock`，不能直接调用，于是就把相关代码复制了过来产生了重复代码。还有就是要把目录里对应的`DirEntry`项删除，不过竟然只提供了`increase_size`没提供`decrease_size`函数，那我就只把`DirEntry`清空算了。看起来这样实现的话`ls`会多出来一些空的项，不过反正测试的时候也没测试到，就不管了。

在`Inode`实现的时候经常会调用`block_cache_sync_all`，感觉不调用应该各项功能也是正常的？

发现`ch6_file3`在测试的时候大量文件内容的写入很耗时间，导致系统运行会超过30秒的timeout被kill掉，还没有思路应该怎么处理。
